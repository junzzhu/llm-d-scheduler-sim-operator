spec:
  template:
    spec:
      containers:
      - name: epp
        image: golang:1.24
        imagePullPolicy: IfNotPresent
        workingDir: /mnt/epp-src
        command: ["/bin/sh","-c"]
        args:
        - |
          go env -w GOPROXY=https://proxy.golang.org,direct &&
          go install github.com/githubnemo/CompileDaemon@latest &&
          /go/bin/CompileDaemon \
            -build="go build -o /tmp/epp ./cmd/epp/main.go" \
            -command="/tmp/epp \
              --pool-name=gaie-inference-scheduling \
              --pool-namespace=llm-d-sim \
              --pool-group=inference.networking.k8s.io \
              --zap-encoder=json \
              --config-file=/etc/epp/epp-config.yaml \
              --kv-cache-usage-percentage-metric=vllm:kv_cache_usage_perc \
              --secure-serving=false \
              --grpc-port=9002 \
              --grpc-health-port=9003 \
              --v=9 \
              --tracing=false" \
            -directory=/mnt/epp-src \
            -polling
        volumeMounts:
        - name: epp-src
          mountPath: /mnt/epp-src
        - name: go-mod-cache
          mountPath: /go/pkg/mod
        - name: go-build-cache
          mountPath: /root/.cache/go-build
      volumes:
      - name: epp-src
        hostPath:
          path: /mnt/epp-src
          type: Directory
      - name: go-mod-cache
        hostPath:
          path: /mnt/epp-go-mod
          type: DirectoryOrCreate
      - name: go-build-cache
        hostPath:
          path: /mnt/epp-go-build
          type: DirectoryOrCreate
